---
modules:
  - docassemble.income.income
  - .prs
  - docassemble.ALToolbox.misc
  - docassemble.AssemblyLine.al_general
  - docassemble.AssemblyLine.al_document
  - docassemble.AssemblyLine.al_courts
---
imports:
  - pycountry
---
include:
  - docassemble.AssemblyLine:ql_baseline.yml
---
metadata:
    title: | 
       MAC PRS Complaint (Language Access)
    description: |
        An interview to fill in MAC's Parent PRS Complaint Form: Language Access.
    authors:
        - name: Matt Brooks and Quinten Steenhuis
          organization: LemmaLegal
    revision_date: 2021-05-09
---
objects:
  - translated_documents: PRSTranslatedDocuments.using(complete_attribute="complete")
  - meetings: PRSMeetings.using(complete_attribute="complete")
  - parent: ALIndividual
  - school: ALIndividual
  - student: ALIndividual
---
mandatory: True
id: mac prs language access complaint interview order block
code: |
  prs_intro
  student.name.first
  parent.name.first  
  school.district_name
  how_notified_school
  parent.language
  if not (translated_documents.there_are_any or meetings.there_are_any):
    kickout_no_problems
  explain_one_at_a_time
  translated_documents.gather()
  if len(translated_documents):
    translated_documents_review
  # TODO: can we have people upload images of the docs?
  meetings.gather()
  if len(meetings):
    meetings_review
  
  # TODO: give them an example of what it looks like at the beginning
  # and end
  
  # Is there someone you want to authorize to communicate with the state
  # about this issue?
  
  # You need to email a copy of this to both DESE and the superintendent
  # of the school. Or mail it to "The office of the superintendent"
  
  add_introduction
  parent.signature
  download_prs
---
code: |
  translated_documents[i].name
  translated_documents[i].complete = True
---
code: |
  meetings[i].name
  meetings[i].complete = True
---
id: prs_intro
continue button field: prs_intro
question: |
  Tell the State about a problem with translations in your child's school
subquestion: |
  This interview will help you tell the State Department of Elementary
  and Secondary Education about a problem with translations in your child's
  school.
  
  You can use this interview if:
  
  1. You are the parent of a child in a Massachusetts public school, and
  1. you speak a language other than English as your first language.
---
id: background info about language needs
question: |
  Your language
fields:
  # TODO: this list is really way too long now
  - What language do you speak best? Type or select one.: parent.language
    datatype: combobox
    code: |
      [lang.name for lang in pycountry.languages]     
  - How did you tell the school about your language needs?: how_notified_school
    datatype: object_checkboxes
    choices: how_notified_school_choices
  - Tell us more about how the school learned that you prefer a language other than English: how_notified_school_details
    required: False
    datatype: area  
---
variable name: how_notified_school_choices
use objects: True
data:
  - question: Phone
    document: phone
  - question: Letter
    document: letter
  - question: In person
    document: in person
  - question: Other verbal notice
    document: verbally notified
  - question: School language survey 
    document: school language survey    
---
sets:
  - student.name.first
  - student.name.last
id: students name
question: |
  What is the name of your child?
fields:
  - code: |
      student.name_fields()
---
id: school info
question: |
  Where does ${ student } go to school?
fields:
  - Name of school: school.name.first
  - School district name: school.district_name
    help: |
      This is often the name of the city where you live.  
  - code: |
      school.address_fields()        
---
sets:
  - parent.name.first
  - parent.name.last
id: parent name
question: |
  What is your name?
subquestion: |
  This should be the name of the parent or legal guardian of ${ student }.
fields:
  - code: |
      parent.name_fields()
---
id: translation problems
question: |
  What kind of language access problems have you had?
subquestion: |
  You have the right to have the school communicate with you in your
  preferred language. That includes both spoken and written communication.
  
  What kind of problems have you had with the school communicating in your
  language?
fields:
  - I have gotten emails, letters or documents that were not translated into my language or were poorly translated: translated_documents.there_are_any
    datatype: yesnowide
  - I have had meetings or phone calls with the school without an interpreter who speaks my language or which were poorly interpreted: meetings.there_are_any
    datatype: yesnowide
---
id: explain how we ask details
question: |
  Language access problems
subquestion: |  
  It can help the Department of Elementary and
  Secondary Education to know about dates and times.
  If you have letters or emails that show times
  that you had language access problems, you may
  want to look at them while you answer these
  questions.
  
  We will ask you for more information about
  each time you had a language access problem,
  one at a time.  
continue button field: explain_one_at_a_time
---
id: kickout no problems
decoration: hand-paper
question: |
  This interview may not be for you
subquestion: |
  This interview is about language access problems.
  
  You said that you have not had any problems with either written or spoken
  language communication with ${ student }'s school district.
  
  You can still download a template letter, but you will need to add your own
  reasons for the complaint.
  
  ${ action_button_html(url_action('translated_documents.there_are_any'), label="Edit your answer") }

field: kickout_no_problems
buttons:
  - Continue: continue
  - Exit: leave
---
id: prs gather names of translated documents
question: |
  Information about the ${ ordinal(i) } document
fields:
  # TODO: make this an open text field for date
  - Date document was sent: translated_documents[i].date
    datatype: date
  - Kind of document: translated_documents[i].name
    input type: radio
    code: |
      evaluation_options
  # TODO: make this flexible to let someone list multiple evaluations
  - What kind of evaluation was it?: translated_documents[i].evaluation_type
    show if: 
      variable: translated_documents[i].name
      is: school_evaluation
  - Describe the document and what happened (optional): translated_documents[i].description
    datatype: area
    required: False
---
variable name: evaluation_options
data:
   school_evaluation: School Evaluation
   progress_reports: Special Education Progress Reports/Grade Reports
   ieps: Individualized Education Programs (IEPs)
   evaluation_consent: Evaluation Consent Forms
   team_meeting: Team Meeting Invitations
   discipline_notices: Notice of School Discipline Hearings and/or Discipline Hearing Decisions
   letter_or_email: Letter or email
   other: Other
---
id: prs is there another translated document
question: |
  Is there another document with a translation problem?
yesno: translated_documents.there_is_another
---
id: prs gather names of meetings
question: |
  What kind of meeting is the ${ ordinal(i) } meeting?
fields:
  - What kind of meeting was this?: meetings[i].type
    datatype: radio
    choices:
      - In-person meeting: in-person meeting
      - Telephone call: telephone call
      - Video meeting or Zoom: video meeting or Zoom meeting      
  - What was the meeting about?: meetings[i].name
  # TODO: let people give an approximate date if they do not know exact
  - When was it?: meetings[i].date
    datatype: date
  # TODO: note that someone did not need to ask for an interpreter
  - Did you ask for an interpreter at the meeting?: meetings[i].requested
    datatype: yesnoradio
  - Was there an interpreter at the meeting?: meetings[i].had_interpreter
    datatype: yesnoradio
  - Did the interpreter do a good job helping you understand what the school said and help the school understand what you said?: meetings[i].interpreter_was_successful
    datatype: yesnoradio
    show if: meetings[i].had_interpreter
  - What else would you like to tell the State about this meeting? (optional): meetings[i].description
    datatype: area
    required: False
---
id: prs is there another meeting
question: |
  Is there another meeting with an interpretation problem?
yesno: meetings.there_is_another
---
id: prs complaint form attachment block
attachment:
  - name: prs_complaint_name
    variable name: prs_complaint_variable
    filename: prs_complaint
    docx template file: prs_complaint_template_language_access.docx
---
id: review translated documents
question: |
  Here is what your letter will say so far
subquestion: |
  Below is a draft of what your letter will tell the
  Department of Elementary and Secondary Education about the problems
  you have had with documents, letters and emails from your child's school.
    
  Look at the draft below. Make any changes that you need.
  
  Hit the enter key to add a new line any time you want a new paragraph in your
  letter.  
fields:
  - Draft: translated_documents_review
    datatype: area
    rows: 5
    default: |
      % for document in translated_documents:
      
      On ${ document.date }, ${ school } sent a ${ evaluation_options[document.name].lower() } that was not translated into ${ parent.language }. ${ fix_punctuation(document.description) }.
      % endfor
    
---
id: review conversations
question: |
  Here is what your letter will say so far
subquestion: |
  Below is a draft of what your letter will tell the
  Department of Elementary and Secondary Education about the problems
  you have had with phone calls, meetings, and video conferences from your 
  child's school.
  
  Look at the draft below. Make any changes that you need.
  
  Hit the enter key to add a new line any time you want a new paragraph in your
  letter.
fields:
  - Draft: meetings_review
    datatype: area
    rows: 5
    default: |
      % for meeting in meetings:
      
      On ${ meeting.date }, I had a ${ meeting.type } meeting with ${ school } about ${ meeting.name }.\
      % if meeting.requested:
       I requested an interpreter who speaks ${ parent.language } at the meeting.\
      % endif
      % if not meeting.had_interpreter:
       There was no interpreter at the meeting.\
      % elif not meeting.interpreter_was_successful:
       The interpretation was poor and I was not able to participate in the meeting.\
      % endif
       ${ fix_punctuation(meeting.description) }
      % endfor
---
id: intro paragraph
question: |
  What would you like to tell the Department of Elementary and Secondary
  Education?
subquestion: |
  Your letter can include:
  
  1. An introduction.
  1. A list of facts about you, the language you speak, and your child.
  1. The list of documents that you told us about that had translation 
  problems.
  1. The list of meetings that you told us about that had interpretation
  problems.
  1. A paragraph that tells DESE about how the translation and interpretation
  problems affected you.
  
  Your letter should be in your own words. Take some time to think about 
  anything you want to tell DESE about.
fields:
  - Do you want to include an introduction?: add_introduction
    datatype: yesnoradio
  - note: |
      This is how your letter will start: 
      > I am filing this complaint because the ${ school.district_name }
      > school 
      > district failed to provide me with adequate interpretation and/or 
      > translation 
      > for matters relating to my child ${ student }â€™s education in the 
      > primary language of my home.  
      
      Finish the paragraph to explain why you are sending this letter.
      
      If you are not sure what to say, it is okay to leave this blank.
    show if: add_introduction
  - Your introduction: letter_introduction
    datatype: area
    show if: add_introduction
  - How did it affect you that the school did not communicate with you in your own language? Use your own words.: letter_outro
    datatype: area
    rows: 5
    required: False
---
id: download
event: download_prs
question: |
  Download your attachment
subquestion: |
  ${ prs_complaint_variable }